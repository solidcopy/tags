【概要】

オーディオファイルのメタ情報(タグ)を管理するツール。


【制作の動機】

音楽プレーヤーソフトでタイトルやアルバムを表示するため、オーディオファイルにはメタ情報が設定されている必要がある。

CDからのリッピング時にはFreeDBなどのオンラインサービスからメタ情報を取得しているが、内容が不正確で間違っていることが多い。

また、音楽配信サービスからダウンロードしたファイルにはあらかじめメタ情報が設定されているが、
各サービスが独自のルールでメタ情報を付与しているため複数サイトからファイルを購入すると書式がばらばらになってしまう。
ファイル名の付け方も同様。

そこで、所持しているオーディオファイルのファイル名とメタ情報を自分のルールで統一するためにtagsを作成した。


【使い方】

前提として以下を満たすようにする。
・1アルバムのオーディオファイルが1ディレクトリに格納されている。
・そのディレクトリが作業ディレクトリである。
・ディスク、トラック番号をキーとした昇順と、ファイル名の昇順が一致している。

$ tags e
でエクスポート処理を実行する。

エクスポート処理では、オーディオファイルから現在設定されているメタ情報を抽出してtagsファイルに保存する。
最初のオーディオファイルにアートワークが設定されている場合は、画像ファイルとして抽出してFolder.xxx(拡張子は画像形式による)に保存する。

tagsファイルを編集して、設定したいタグの内容にする。

$ tags i
でインポート処理を実行する。

インポート処理では、tagsファイルから読み込んだメタ情報をオーディオファイルに設定する。
Folder.xxx(拡張子は画像形式による)というファイルがある場合、その内容をアートワークとして各オーディオファイルに設定する。

$ tags r
でリネーム処理を実行する。

リネーム処理では、オーディオファイルに設定されたメタ情報を元にファイル名を決定してリネームする。
ファイル名は

[ディスク番号].[トラック番号].[タイトル].[拡張子]

という形式で決める。
ディスク数が1の場合、ディスク番号は省略する。
タイトルにファイル名には使えない文字がふくまれている場合は適宜削除や置き換えをする。

$ tags
とオプションなしで実行した場合は、
tagsファイルがなければエクスポート処理を実行する。
tagsファイルがあればインポート処理とリネーム処理を続けて実行する。


【取り扱うタグの一覧】

・凡例
[タグ] ([Vorbis Comment名], [ID3v2タグ名])

・アルバム単位
アルバム (album, TALB)
アルバムアーティスト (albumartist, TPE2)
ディスク数 (disctotal, TPOS(c/tのt))
発売日 (date, TYERおよびTDAT)

・ディスク単位
ディスク番号 (discnumber, TPOS(c/tのc))
トラック数 (tracktotal, TRCK(c/tのt))

・トラック単位
トラック番号 (tracknumber, TRCK(c/tのc))
タイトル (title, TIT2)
アーティスト (artist, TPE1)


【tagsファイルの形式】

tagsファイルは以下の形式のテキストファイルである。
エンコーディングはUTF-8とする。

============================================================
[アルバム情報]

[ディスク情報1]

[ディスク情報2]

[ディスク情報3]

[ディスク情報n...]
============================================================

アルバム情報は以下の形式。
============================================================
[アルバム]
[アルバムアーティスト]
[発売日]
============================================================

発売日の書式はyyyy-mm-dd。
不明な項目は省略してもよいが、その項目が出力されるべき位置に空白行が必要。

ディスク情報は以下の形式。
============================================================
[タイトル]//[アーティスト1]//[アーティスト2]//[アーティストn...]
上記をトラック数分記述する
============================================================

アーティストは任意の数を設定可能で、一人も設定しない場合は//は不要。
アーティストが設定されていない場合は、アルバムアーティストが同時にタイトルのアーティストでもあるとみなす。

タイトルの記述はアルバム内における順序と一致していること。

トラック番号、トラック数、ディスク番号、ディスク数はtagsファイルに記載しない。
これらの項目はtagsファイル内での記述位置や項目の設定された数によって判断する。


【対象ファイルフォーマット】

・FLAC
・MP3
・MP4 (.m4a, .m4p)
・DSF


【モジュール構成】

メタ情報オブジェクト
    メタ情報を表すオブジェクトを定義する。
    特定のファイル形式、タグ形式には依存しない。
    metaパッケージに配置する。

オーディオファイルオブジェクト
    AudioFileクラスがオーディオファイルから抽出するメタ情報の項目をプロパティとして定義している。
    オーディオファイルの形式ごとにサブクラスを定義する。
    サブクラスは、エクスポート時に担当する形式のオーディオファイルからメタ情報を取得してAudioFileのプロパティに設定する。
    インポート時にはAudioFileのプロパティをオーディオファイルのメタ情報として出力する。
    file_formatパッケージに配置する。

タグファイル入出力
    tagsファイルを読み書きする。
    入出力のデータ形式はメタ情報とする。
    tag_fileパッケージに配置する。

サービス
    処理の流れを規定するコントローラー役。
    serviceパッケージに配置する。

共通
    上記に分類できない汎用的なモジュール。
    commonパッケージに配置する。

特定のパッケージでのみ使用する定数、メッセージ、例外クラスがある場合、
それぞれconst.py, messages.py, errors.pyというモジュールを用意してその中で定義する。

メタ情報オブジェクトは状態を持つためにクラスとして作成する。
オーディオファイルオブジェクトはポリモーフィズムを活用するためクラスとして作成する。
その他のモジュールは通常の関数として作成する。
